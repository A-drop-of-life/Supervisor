<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل مشرف جديد</title>
<style>
body{font-family:Arial;direction:rtl;background:#f4f6f8;display:flex;justify-content:center;align-items:center;height:100vh;}
.box{background:#fff;padding:25px;width:100%;max-width:400px;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,0.15);}
h2{text-align:center;color:#b71c1c;margin-bottom:20px;}
input,button{width:100%;padding:10px;margin:8px 0;font-size:15px;}
button{background:#b71c1c;color:#fff;border:none;border-radius:6px;font-weight:bold;cursor:pointer;}
button:hover{background:#a00000;}
.msg{color:red;text-align:center;margin-top:10px;}
.password-wrapper{position:relative;}
.toggle-pass{position:absolute;top:50%;left:10px;transform:translateY(-50%);cursor:pointer;font-size:14px;color:#555;}
.small-text{font-size:12px;color:#555;margin-top:-5px;margin-bottom:10px;}
</style>
</head>
<body>
<div class="box">
<h2>تسجيل مشرف جديد</h2>

<input type="text" id="username" placeholder="أدخل اسم المستخدم">
<input type="email" id="email" placeholder="أدخل البريد الإلكتروني">

<div class="password-wrapper">
  <input type="password" id="password" placeholder="أدخل كلمة المرور">
  <span class="toggle-pass" id="togglePass">إظهار</span>
</div>
<div class="small-text">كلمة المرور يجب أن تكون 6 أحرف على الأقل</div>

<button id="registerBtn">تسجيل المشرف</button>
<div class="msg" id="msg"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyBWIy4ny6Ki39OerkkH9gT-jr63Vn8s9Uk",
    authDomain: "drop-of-life-df6bf.firebaseapp.com",
    projectId: "drop-of-life-df6bf",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const msg = document.getElementById('msg');
const togglePass = document.getElementById('togglePass');
const passwordInput = document.getElementById('password');
const usernameInput = document.getElementById('username');
const emailInput = document.getElementById('email');
const registerBtn = document.getElementById('registerBtn');

// إظهار/إخفاء كلمة المرور
togglePass.onclick = ()=>{
    if(passwordInput.type==="password"){
        passwordInput.type="text";
        togglePass.textContent="إخفاء";
    }else{
        passwordInput.type="password";
        togglePass.textContent="إظهار";
    }
};

// تسجيل المشرف الجديد
registerBtn.onclick = async ()=>{
    msg.textContent="";
    const usernameVal = usernameInput.value.trim();
    const emailVal = emailInput.value.trim();
    const passVal = passwordInput.value.trim();

    if(!usernameVal || !emailVal || !passVal){
        msg.textContent="يرجى تعبئة جميع الحقول";
        return;
    }
    if(passVal.length < 6){
        msg.textContent="كلمة المرور يجب أن تكون 6 أحرف على الأقل";
        return;
    }

    try{
        // إنشاء مستخدم جديد في Firebase Auth
        const cred = await createUserWithEmailAndPassword(auth,emailVal,passVal);

        // حفظ بيانات إضافية في Firestore
        await setDoc(doc(db,"admins",cred.user.uid), { username: usernameVal, email: emailVal });

        // تسجيل الدخول تلقائيًا بعد التسجيل
        await signInWithEmailAndPassword(auth,emailVal,passVal);

        // الانتقال إلى صفحة index.html
        location.href = "index.html";
    }catch(e){
        console.error(e);
        if(e.code==="auth/email-already-in-use") msg.textContent="هذا البريد مستخدم بالفعل";
        else msg.textContent="حدث خطأ أثناء التسجيل: "+e.message;
    }
};
</script>
</body>
</html>